################################################################################
#
# template_asp_net_build_publish
# Template should be used to build and publish a ASP.NET web app
# Template will First call the NuGet template to install and download nuget packages
# Then it will Build the VS solution
# Finally will publish the build artifact
#
# REVISION HISTORY
# KG - 10/04/2024 - Initial Version
#
################################################################################

parameters:
- name: solution
  default: '**/*.sln'
- name: buildPlatform
  default: 'Any CPU'
- name: buildConfiguration
  default: 'Release'
- name: artifactName
  default: 'Artifact'

steps:
- template: template_nuget_restore.yml
  parameters:
    solution: '$(solution)'

- task: VSBuild@1
  name: 'Build'
  displayName: 'Build Solution'
  inputs:
    solution: ${{ parameters.solution }}
    platform: ${{ parameters.buildPlatform }}
    configuration: ${{ parameters.buildConfiguration }}
    msbuildArgs: '/p:DeployOnBuild=true /p:WebPublishMethod=Package /p:PackageAsSingleFile=true /p:SkipInvalidConfigurations=true /p:PackageLocation="$(build.artifactStagingDirectory)"'
    clean: true

- task: PublishBuildArtifacts@1
  displayName: 'Publish Build Artifact'
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)'
    ArtifactName: ${{ parameters.artifactName }}
    publishLocation: 'Container'